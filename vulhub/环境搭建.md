首先要安装docker-compose

```
apt install docker-compose
```

注意kali中不能用传统的pip3安装。

```docker-compose -v```确认安装成功

然后下载vulhub:

```
git clone --depth 1 https://github.com/vulhub/vulhub.git
```

进入任何一个CVE漏洞目录下：

```
cd vulhub/weblogic/CVE-2018-2628
```

然后启动环境：

```
docker-compose up -d   (-d是在后台)
```

清除容器：

```
docker-compose down
```

一开始启动失败，我们查看日志文件：

```
dcoker-compose logs weblogic
```

或者不加-d参数，错误信息会直接打印出来：

```
webloogic-1  | library initialization failed - unable to allocate file descriptor table - out of memoryaborted (core dumped)
```

超出内存，无法分配文件描述符。

`ulimit -n`查看最大文件描述符，默认是1024.

网上有人说是这个值太小了，其实不对。在`/lib/systemd/system/docker.service`中默认是：

```
LimitCORE=infinity

LimitNOFILE=infinity

LimitNPROC=infinity
```

有人说在systemctl版本小于234时候infinity不生效，但是我们的版本大于234。

总结下来分配内容空间是文件描述符太多导致内存空间不足。实测有效的解决办法：

在找到 docker.service 文件（一般在`/lib/systemd/system/docker.service`）在 `ExecStart=/usr/bin/dockerd` 后面添加 `--default-ulimit nofile=65536:65536` 参数

然后重启docker服务即可。